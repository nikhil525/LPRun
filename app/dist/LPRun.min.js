/*! LPRun 27-03-2017 */
app.controller("LogRaceCtrl",["$scope","$location","$http",function(a,b,c){function d(b){return a.records.map(function(a){return a.LapNumber}).indexOf(b.LapNumber)}c.get("http://lilmonkey.net/lpservices/Wishes.svc/getrunner/?Bib=49").then(function(b){a.runnerinfo=b.data,a.records=b.data.Laps,console.log(JSON.stringify(b.data.Laps))}),a.timere=/^[0-9]{2}:[0-9]{2}$/,a.validatetimee=[30],a.validatetime=function(b,c){a.validatetimee[c]=a.timere.test(b),console.log(a.validatetimee[c])},a.isDisabled=function(b){return!a.validatetimee[b]},a.saveLap=function(b){c.get("http://lilmonkey.net/lpservices/Wishes.svc/savelap/?Bib=49&Lap="+b.LapNumber+"&Time="+b.LapTime).then(function(c){if(a.runnerinfo=c.data,c.data&&(lapIndex=d(b),a.records[lapIndex].LapCompleted=!0,b.LapNumber==a.records.length)){var e={LapNumber:a.records.length+1,LapTime:"",LapCompleted:!1};a.records.push(e)}console.log("save was: "+c.data)})},a.editLap=function(b){lapIndex=d(b),a.records[lapIndex].LapCompleted=!1,a.records[lapIndex].backuptime=b.LapTime},a.cancelLapChanges=function(b){lapIndex=d(b),lapIndex!=a.records.length-1?(a.records[lapIndex].LapTime=a.records[lapIndex].backuptime,a.records[lapIndex].LapCompleted=1):a.records[lapIndex].LapTime=""}}]),app.directive("sampleTemplate",function(){return{restrict:"AE",replace:"true",template:'<p style="background-color:{{color}}">Sample Template</p>',link:function(a,b){b.bind("click",function(){b.css("background-color","white"),a.$apply(function(){a.color="white"})}),b.bind("mouseover",function(){b.css("cursor","pointer")})}}}),app.directive("countdown",["Util","$interval",function(a,b){return{restrict:"A",replace:"false",scope:{date:"@"},link:function(c,d){var e;e=new Date(c.date),b(function(){var b;return b=Math.floor((e.getTime()-(new Date).getTime())/1e3),d.text(a.dhms(b))},1e3)}}}]),app.service("Util",[function(){return{dhms:function(a){var b,c,d,e;return b=Math.floor(a/86400),a-=86400*b,c=Math.floor(a/3600)%24,a-=3600*c,d=Math.floor(a/60)%60,a-=60*d,e=a%60,[b+"d",c+"h",d+"m",e+"s"].join(" ")}}}]),app.controller("SignInCtrl",["$scope","$location",function(a,b){a.message="LP RUN",a.startRace=function(){a.message="Run starts in...",b.path("lograce")}}]),app.config(function(a){a.when("/",{templateUrl:"partials/home.html"}).when("/error",{templateUrl:"partials/error.html"}).when("/results",{templateUrl:"partials/results.html"}).when("/lograce",{templateUrl:"partials/lograce.html"})});